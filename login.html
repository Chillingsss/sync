<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body class="d-flex justify-content-center align-items-center bg-dark" style="height: 100vh;">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-4">

                <div class="card">

                    <div class="card-header d-flex justify-content-center align-items-center"
                        style="font-size: 30px; font-family:Georgia, 'Times New Roman', Times, serif; height: 50px;">
                        Sync
                    </div>



                    <div id="login-form" class="card-body form-container">
                        <form>
                            <div class="form-group">
                                <input type="text" class="form-control" id="loginUsername" placeholder="Username"
                                    required>
                                <small id="usernameErrorMsg" class="form-text text-danger"></small>
                                <!-- Add error message element -->
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control" id="loginPassword" placeholder="Password"
                                    required>
                                <small id="passwordErrorMsg" class="form-text text-danger"></small>
                                <!-- Add error message element -->
                            </div>
                        </form>
                        <div class="text-center">
                            <button class="btn btn-primary col-md-4 mx-auto" onclick="loginUser()">Login</button>
                        </div>
                    </div>


                </div>

                <div id="register" class="card mt-2 ">
                    <div class="card-body d-flex justify-content-center align-items-center">
                        <p class="m-0">Don't have an account?
                            <a type="button" class="" data-toggle="modal" data-target="#exampleModal">
                                Sign up
                            </a>
                        </p>
                    </div>
                </div>

                <!-- Modal -->
                <div class="modal fade " id="exampleModal" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog col-md-4 mx-auto " role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"
                                    style="font-size: 30px; font-family:Georgia, 'Times New Roman', Times, serif; height: 40px;"
                                    id="exampleModalLabel">Sign up</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="registration-form-inner" method="post">
                                    <div class="form-group" style="margin-bottom: 20px;">
                                        <input type="text" class="form-control" name="reg-firstname" id="reg-firstname"
                                            placeholder="First Name" required>
                                        <small id="firstnameErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="text" class="form-control" name="reg-middlename"
                                            id="reg-middlename" placeholder="Middle Name" required>
                                        <small id="middlenameErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="text" class="form-control" name="reg-lastname" id="reg-lastname"
                                            placeholder="Last Name" required>
                                        <small id="lastnameErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="email" class="form-control" name="reg-email" id="reg-email"
                                            placeholder="Email" required>
                                        <small id="emailErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="number" class="form-control" name="reg-cpnumber" id="reg-cpnumber"
                                            placeholder="Contact Number" required>
                                        <small id="contactErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="text" class="form-control" name="reg-username" id="reg-username"
                                            placeholder="Username" required>
                                        <small id="usernameErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 10px;">
                                        <input type="password" class="form-control" name="reg-password"
                                            id="reg-password" placeholder="Password" required>
                                        <small id="passwordErrorMsg" class="form-text text-danger"></small>
                                    </div>
                                    <div class="d-flex justify-content-center">
                                        <button class="btn btn-success w-25" onclick="registerUser()">Sign up</button>
                                    </div>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- <div id="registration-card" class="card mt-2 d-none">

          <div class="card-header">
            Registration
          </div>
          <div class="card-body form-container">
            <form id="registration-form-inner" method="post">
              <div class="form-group">
                <input type="text" class="form-control" name="reg-firstname" id="reg-firstname" placeholder="First Name"
                  required>
                <small id="firstnameErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="text" class="form-control" name="reg-middlename" id="reg-middlename"
                  placeholder="Middle Name" required>
                <small id="middlenameErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="text" class="form-control" name="reg-lastname" id="reg-lastname" placeholder="Last Name"
                  required>
                <small id="lastnameErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="email" class="form-control" name="reg-email" id="reg-email" placeholder="Email" required>
                <small id="emailErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="number" class="form-control" name="reg-cpnumber" id="reg-cpnumber"
                  placeholder="Contact Number" required>
                <small id="contactErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="text" class="form-control" name="reg-username" id="reg-username" placeholder="Username"
                  required>
                <small id="usernameErrorMsg" class="form-text text-danger"></small>
              </div>
              <div class="form-group">
                <input type="password" class="form-control" name="reg-password" id="reg-password" placeholder="Password"
                  required>
                <small id="passwordErrorMsg" class="form-text text-danger"></small>
              </div>
              <button class="btn btn-success btn-block" onclick="registerUser()">Register</button>
              <button id="back-to-login" onclick="showLoginForm()" class="btn btn-sm btn-outline-primary d-none">Back to
                Login</button>

            </form>
          </div>
        </div> -->

            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


    <script>

        $('#myModal').on('shown.bs.modal', function () {
            $('#myInput').trigger('focus')
        })

        var isLoggedIn = localStorage.getItem('isUserLoggedIn');

        if (isLoggedIn === "true") {

            window.location.href = "index.php";
        }
        else {
            console.log(isLoggedIn);
        }

        function showRegistrationForm() {
            document.getElementById('login-form').classList.add('d-none');
            document.getElementById('register').classList.add('d-none');
            document.getElementById('registration-card').classList.remove('d-none');
            document.getElementById('back-to-login').classList.remove('d-none');


        }

        function showLoginForm() {
            document.getElementById('registration-card').classList.add('d-none');
            document.getElementById('login-form').classList.remove('d-none');
            document.getElementById('register').classList.remove('d-none');
        }



        // Check if there is a session identifier in the localStorage
        // var sessionId = localStorage.getItem('session_id');
        // if (sessionId) {
        //     checkLoginStatus();
        // }

        // function checkLoginStatus() {
        //     console.log("Check login status called");
        //     var sessionId = localStorage.getItem('session_id');
        //     if (sessionId) {
        //         var xhr = new XMLHttpRequest();
        //         xhr.open('GET', 'PHP/check_login.php', true);
        //         xhr.onload = function () {
        //             if (xhr.status === 200) {
        //                 var response = JSON.parse(xhr.responseText);
        //                 console.log(response);
        //                 if (response.status === 'success') {
        //                     isLoggedIn = true;
        //                     document.getElementById('update-details-btn').removeAttribute('disabled');
        //                     document.getElementById('delete-account-btn').removeAttribute('disabled');
        //                     document.getElementById('update-details-btn').style.display = 'block';
        //                     document.getElementById('delete-account-btn').style.display = 'block';
        //                     document.getElementById('logout-btn').style.display = 'block';
        //                 } else {
        //                     handleLogout();
        //                 }
        //             } else {
        //                 console.error("Error checking login status. Status: " + xhr.status);
        //                 handleLogout();
        //             }
        //         };
        //         xhr.send();
        //     } else {
        //         handleLogout();
        //     }
        // }

        function handleLogout() {
            isLoggedIn = false;
            document.getElementById('update-details-btn').style.display = 'none';
            document.getElementById('delete-account-btn').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'none';
            showForm('login');
            history.pushState({}, null, 'login.html');
        }

        function showForm(option) {
            var forms = document.querySelectorAll('.form-container');
            forms.forEach(form => form.style.display = 'none');
            document.getElementById(option + '-form').style.display = 'block';

            // Always hide buttons when switching forms
            document.getElementById('update-details-btn').style.display = 'none';
            document.getElementById('delete-account-btn').style.display = 'none';
            document.getElementById('logout-btn').style.display = isLoggedIn ? 'block' : 'none';
        }

        function registerUser() {
            try {
                const firstnameInput = document.getElementById("reg-firstname");
                const middlenameInput = document.getElementById("reg-middlename");
                const lastnameInput = document.getElementById("reg-lastname");
                const emailInput = document.getElementById("reg-email");
                const contactInput = document.getElementById("reg-cpnumber");
                const usernameInput = document.getElementById("reg-username");
                const passwordInput = document.getElementById("reg-password");

                const firstnameErrorMsg = document.getElementById("firstnameErrorMsg");
                const middlenameErrorMsg = document.getElementById("middlenameErrorMsg");
                const lastnameErrorMsg = document.getElementById("lastnameErrorMsg");
                const emailErrorMsg = document.getElementById("emailErrorMsg");
                const contactErrorMsg = document.getElementById("contactErrorMsg");
                const usernameErrorMsg = document.getElementById("usernameErrorMsg");
                const passwordErrorMsg = document.getElementById("passwordErrorMsg");

                // Reset previous error messages and border colors
                firstnameErrorMsg.textContent = '';
                middlenameErrorMsg.textContent = '';
                lastnameErrorMsg.textContent = '';
                emailErrorMsg.textContent = '';
                contactErrorMsg.textContent = '';
                usernameErrorMsg.textContent = '';
                passwordErrorMsg.textContent = '';

                // Check if any field is empty
                if (firstnameInput.value.trim() === '' || middlenameInput.value.trim() === '' ||
                    lastnameInput.value.trim() === '' || emailInput.value.trim() === '' ||
                    contactInput.value.trim() === '' || usernameInput.value.trim() === '' ||
                    passwordInput.value.trim() === '') {
                    // Display error messages for empty fields
                    if (firstnameInput.value.trim() === '') {

                        firstnameInput.style.borderColor = 'red';
                    }
                    if (middlenameInput.value.trim() === '') {

                        middlenameInput.style.borderColor = 'red';
                    }
                    if (lastnameInput.value.trim() === '') {

                        lastnameInput.style.borderColor = 'red';
                    }
                    if (emailInput.value.trim() === '') {

                        emailInput.style.borderColor = 'red';
                    }
                    if (contactInput.value.trim() === '') {

                        contactInput.style.borderColor = 'red';
                    }
                    if (usernameInput.value.trim() === '') {
                        console.log("Username is empty");

                        usernameInput.style.borderColor = 'red';
                    }
                    if (passwordInput.value.trim() === '') {
                        console.log("Password is empty");

                        passwordInput.style.borderColor = 'red';
                    }
                    return; // Stop further execution
                }

                // Proceed with form submission if all validations pass
                const formData = new FormData(document.getElementById('registration-form-inner'));
                // You can proceed with the Axios request here
            } catch (error) {
                console.error("Registration error: ", error);
            }
        }






        // function loginUser() {
        //     var formData = new FormData(document.getElementById('login-form-inner'));

        //     // Use Axios for the login request
        //     axios.post('PHP/login.php', formData)
        //         .then(function (response) {
        //             console.log("Login response:", response.data);

        //             if (response.data.status === 'success') {
        //                 localStorage.setItem("firstname", response.data.userDetails.firstname);
        //                 localStorage.setItem("middlename", response.data.userDetails.middlename);
        //                 localStorage.setItem("lastname", response.data.userDetails.lastname);
        //                 localStorage.setItem("username", response.data.userDetails.username);

        //                 localStorage.setItem("isUserLoggedIn", "true");

        //                 window.location.href = "dashboard.html";
        //             } else {
        //                 alert("Login failed: " + response.data.message);
        //             }
        //         })
        //         .catch(function (error) {
        //             console.error("Login request failed:", error);
        //         });
        // }

        //lerio version
        function loginUser() {
            try {
                const usernameInput = document.getElementById("loginUsername");
                const passwordInput = document.getElementById("loginPassword");
                const usernameErrorMsg = document.getElementById("usernameErrorMsg");
                const passwordErrorMsg = document.getElementById("passwordErrorMsg");

                // Reset previous error messages and border colors
                usernameErrorMsg.textContent = '';
                passwordErrorMsg.textContent = '';
                usernameInput.style.borderColor = '';
                passwordInput.style.borderColor = '';

                // Check if the username or password fields are empty
                if (usernameInput.value.trim() === '' || passwordInput.value.trim() === '') {
                    if (usernameInput.value.trim() === '') {
                        usernameErrorMsg.textContent = 'Username cannot be empty';
                        usernameInput.style.borderColor = 'red';
                    }
                    if (passwordInput.value.trim() === '') {
                        passwordErrorMsg.textContent = 'Password cannot be empty';
                        passwordInput.style.borderColor = 'red';
                    }
                    return; // Stop further execution
                }

                const formData = new FormData();

                const jsonData = {
                    loginUsername: usernameInput.value,
                    loginPassword: passwordInput.value
                }

                formData.append("operation", "loginUser");
                formData.append("json", JSON.stringify(jsonData));

                axios({
                    url: "http://localhost/media/PHP/login.php",
                    method: "post",
                    data: formData,
                })
                    .then((response) => {
                        console.log(response)
                        console.log(response.data.data[0])
                        if (response.data.status === -1) {
                            // If login fails, highlight the input fields with a red border
                            usernameErrorMsg.textContent = 'Incorrect username or password';
                            passwordErrorMsg.textContent = 'Incorrect username or password';
                            usernameInput.style.borderColor = 'red';
                            passwordInput.style.borderColor = 'red';
                        } else {
                            localStorage.setItem("firstname", response.data.data[0].firstname);
                            localStorage.setItem("middlename", response.data.data[0].middlename);
                            localStorage.setItem("lastname", response.data.data[0].lastname);
                            localStorage.setItem("email", response.data.data[0].email);
                            localStorage.setItem("cpnumber", response.data.data[0].cpnumber);
                            localStorage.setItem("username", response.data.data[0].username);
                            localStorage.setItem("password", response.data.data[0].password);
                            localStorage.setItem("isUserLoggedIn", "true");
                            window.location.href = "index.php";
                        }
                    })
                    .catch((error) => {
                        console.error("Login error: ", error);
                    });
            } catch (error) {
                console.error("Login error: ", error);
            }
        }









        // document.addEventListener('DOMContentLoaded', function () {
        //     // Add event listeners to the buttons
        //     document.getElementById('logout-btn').addEventListener('click', logout);
        //     document.getElementById('login-btn').addEventListener('click', function () {
        //         showForm('login');
        //     });
        //     document.getElementById('register-btn').addEventListener('click', function () {
        //         showForm('registration');
        //     });
        //     document.getElementById('update-details-btn').addEventListener('click', updateDetails);
        //     document.getElementById('delete-account-btn').addEventListener('click', deleteAccount);

        //     // Additional listeners for login and registration forms
        //     document.getElementById('login-form-inner').addEventListener('submit', function (e) {
        //         e.preventDefault(); // Prevent the default form submission
        //         loginUser();
        //     });

        //     document.getElementById('registration-form-inner').addEventListener('submit', function (e) {
        //         e.preventDefault(); // Prevent the default form submission
        //         registerUser();
        //     });
        // });

    </script>

</body>

</html>